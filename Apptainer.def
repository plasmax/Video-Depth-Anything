Bootstrap: docker
From: ubuntu:22.04

%post
    set -e

    apt-get update
    apt-get install -y --no-install-recommends \
        python3.10 python3.10-venv python3-pip \
        ca-certificates curl \
        && rm -rf /var/lib/apt/lists/*

    python3.10 -m pip install -U pip uv

    cat > /tmp/requirements.txt <<'EOF'
numpy==1.24.0
torch==2.1.1
torchvision==0.16.1
opencv-python
matplotlib
pillow
imageio==2.37.0
imageio-ffmpeg==0.4.7
decord
xformers==0.0.23
einops==0.4.1
easydict
tqdm
OpenEXR==3.3.1
EOF

    uv pip install --system -r /tmp/requirements.txt

%environment
    export PYTHONUNBUFFERED=1

%runscript
    exec python3.10 "$@"

%test
    python3.10 -c "import torch; print('torch', torch.__version__); print('cuda', torch.cuda.is_available())"
