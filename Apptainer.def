Bootstrap: docker
From: ubuntu:22.04

%files
    ./requirements.txt /

%post
    set -e

    apt-get update
    apt-get install -y --no-install-recommends \
        python3.10 python3.10-venv python3-pip \
        ca-certificates curl \
        libgl1 \
        libglib2.0-0 \
        && rm -rf /var/lib/apt/lists/*

    python3.10 -m pip install -U pip uv pyright[nodejs]

    uv pip install --system -r requirements.txt

%environment
    export PYTHONUNBUFFERED=1

%test
    python3.10 -c "import torch; print('torch', torch.__version__); print('cuda', torch.cuda.is_available())"
